<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: pages/findmod.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-modules"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-DB.html">DB</a></div><div class="sidebar-section-children"><a href="module-api.html">api</a></div><div class="sidebar-section-children"><a href="module-discord.html">discord</a></div><div class="sidebar-section-children"><a href="module-main.html">main</a></div><div class="sidebar-section-children"><a href="module-timers.html">timers</a></div><div class="sidebar-section-children"><a href="module-web.html">web</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Log.html">Log</a></div><div class="sidebar-section-children"><a href="UserEntry.html">UserEntry</a></div><div class="sidebar-section-children"><a href="module-DB.ActionEntry.html">ActionEntry</a></div><div class="sidebar-section-children"><a href="module-DB.ModEntry.html">ModEntry</a></div><div class="sidebar-section-children"><a href="module-DB.ModVersionEntry.html">ModVersionEntry</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Config.html">Config</a></div><div class="sidebar-section-children"><a href="module-DB.GetAction.html">GetAction</a></div><div class="sidebar-section-children"><a href="module-DB.GetMod.html">GetMod</a></div><div class="sidebar-section-children"><a href="module-DB.GetMod.Data.html">Data</a></div><div class="sidebar-section-children"><a href="module-DB.GetMod.Versions.html">Versions</a></div><div class="sidebar-section-children"><a href="module-DB.GetUser.html">GetUser</a></div><div class="sidebar-section-children"><a href="module-api.actions.html">actions</a></div><div class="sidebar-section-children"><a href="module-api.admin.html">admin</a></div><div class="sidebar-section-children"><a href="module-api.adminactions.html">adminactions</a></div><div class="sidebar-section-children"><a href="module-api.config.html">config</a></div><div class="sidebar-section-children"><a href="module-api.search.html">search</a></div><div class="sidebar-section-children"><a href="module-api.uploadmod.html">uploadmod</a></div><div class="sidebar-section-children"><a href="module-api.users.html">users</a></div><div class="sidebar-section-children"><a href="module-discord.BotEvents.html">BotEvents</a></div><div class="sidebar-section-children"><a href="module-discord.Events.html">Events</a></div><div class="sidebar-section-children"><a href="module-discord.Events.clientready.html">clientready</a></div><div class="sidebar-section-children"><a href="module-discord.Events.interactioncreate.html">interactioncreate</a></div><div class="sidebar-section-children"><a href="module-discord.commands.html">commands</a></div><div class="sidebar-section-children"><a href="module-discord.commands.GetModInfo.html">GetModInfo</a></div><div class="sidebar-section-children"><a href="module-discord.commands.GetModVersions.html">GetModVersions</a></div><div class="sidebar-section-children"><a href="module-discord.commands.getSiteActions.html">getSiteActions</a></div><div class="sidebar-section-children"><a href="module-discord.commands.searchMods.html">searchMods</a></div><div class="sidebar-section-children"><a href="module-timers.logactions.html">logactions</a></div><div class="sidebar-section-children"><a href="module-timers.updatemods.html">updatemods</a></div><div class="sidebar-section-children"><a href="module-timers.validatemod.html">validatemod</a></div><div class="sidebar-section-children"><a href="module-web.admin.html">admin</a></div><div class="sidebar-section-children"><a href="module-web.discordAuth.html">discordAuth</a></div><div class="sidebar-section-children"><a href="module-web.generateMod.html">generateMod</a></div><div class="sidebar-section-children"><a href="module-web.home.html">home</a></div><div class="sidebar-section-children"><a href="module-web.upload.html">upload</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-global"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#handleClient">handleClient</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">pages_findmod.js</h1></header><article><pre class="prettyprint source lang-js"><code>/**
 * @file findmod.js
 * @description Handles APIs for searching and retrieving mod information, versions, and files.
 * This module provides RESTful endpoints to search the mod database, download specific versions, and retrieve mod metadata.
 * It serves as the primary interface between the frontend and the mod database.
 */

var Utils = require("./../utils");
var { decompress } = require("@mongodb-js/zstd");
var Mongo = require("./../shared/db");

var log = new Utils.Log("sandustry.web.pages.search", "./sandustry.web.main.txt", true);

/**
 * Namespace for mod search and retrieval functionality within the web module.
 * This provides the API endpoints that power the mod browser interface.
 * @namespace search
 * @memberof module:api
 */
module.exports = {
	/**
	 * The paths that use this module.
	 * @type {Array&lt;string>}
	 * @memberof module:api.search
	 */
	paths: ["/api/mods"],

	/**
	 * Handles API requests for mod search and retrieval.
	 *
	 * Depending on the query parameters, the API provides different functionality:
	 * - Search for mods using keywords.
	 * - Fetch metadata of a specific mod (e.g., name, version, dependencies).
	 * - Download a specific version of a mod.
	 * - Retrieve a list of available versions for a mod.
	 *
	 * ### Query Parameters:
	 * - **search**: *(optional)*
	 *   Searches for mods using a MongoDB query provided as a JSON string.
	 *   Must be a valid JSON string that is URL-encoded.
	 *   - *Example*: `search=%7B%22modData.name%22%3A%7B%22%24regex%22%3A%22test%22%2C%22%24options%22%3A%22i%22%7D%7D`
	 *   - This example decodes to: `{"modData.name":{"$regex":"test","$options":"i"}}`
	 *
	 * - **modid**: *(required for non-search options unless modids is provided)*
	 *   The unique ID of the mod to retrieve information or download.
	 *   - *Example*: `modid=1234`
	 * 
	 * - **modids**: *(can be used instead of modid for the versions option)*
	 *   A comma-separated list of mod IDs to retrieve versions for.
	 *   - *Example*: `modids=1234,5678,9012`
	 *
	 * - **option**: *(required for non-search options)*
	 *   Specifies the action to be performed. Supported values:
	 *   - `"info"`: Retrieves metadata of a specific mod.
	 *   - `"download"`: Downloads a mod version.
	 *   - `"versions"`: Fetches a list of available versions for the mod(s).
	 *     - With `modid` parameter: Returns versions for a single mod.
	 *       - With `data=true` parameter: Returns full version data for each version.
	 *       - Without `data` parameter: Returns only version numbers (default behavior).
	 *     - With `modids` parameter: Returns version numbers for multiple mods as an object mapping each modID to its array of versions.
	 *       - Note: `data=true` is not supported with `modids` parameter.
	 *   - *Example*: `option=info`
	 *
	 * - **version**: *(optional)*
	 *   The specific version of a mod to retrieve or download. If not provided, the latest version will be used.
	 *   - *Example*: `version=1.0.0`
	 *
	 * - **page**: *(optional, only for `search`)*
	 *   Specifies the page of results to return for the search query. Defaults to `1`.
	 *   - *Example*: `page=2`
	 *
	 * - **size**: *(optional, only for `search`)*
	 *   Specifies the number of results to return per page. Defaults to `10`.
	 *   - *Example*: `size=25`
	 *
	 * ### Behavior for Query Options:
	 * 1. `search`: Performs MongoDB queries on mod data using a JSON query string provided in the `search` parameter. 
	 *    Supports pagination with `page` and `size`. The search parameter should be a URL-encoded JSON string.
	 *    - Default behavior: Returns the first 200 results (`page=1`, `size=200`).
	 *    - Example query: `/api/mods?search=%7B%22modData.name%22%3A%7B%22%24regex%22%3A%22test%22%2C%22%24options%22%3A%22i%22%7D%7D&amp;page=2&amp;size=20`
	 * 2. `info`: Retrieves metadata for a mod ID, optionally filtered by version.
	 *    Requires `modid`, and optionally `version`.
	 * 3. `download`: Downloads a specific version of a mod.
	 *    Requires `modid`, and optionally `version`.
	 * 4. `versions`: Fetches a list of all available versions for the mod ID.
	 *    Requires `modid`.

	 * @async
	 * @function run
	 * @memberof module:api.search
	 * @param {IncomingMessage} req - The HTTP request object.
	 * @param {ServerResponse} res - The HTTP response object.
	 *
	 * @returns {Promise&lt;void>} - The response is sent directly to the client.
	 *
	 * @throws {Error} If query parameters are missing or other errors occur during processing.
	 *
	          * Additional query parameters for search:
	          * - **verified**: *(optional, only for `search`)*
	          *   Filters mods by verification status:
	          *   - `"true"`: Return only verified mods
	          *   - `"false"`: Return only unverified mods
	          *   - `"null"` or omitted: Return all mods regardless of verification status
	          *   - *Example*: `verified=true`
	 *
	 * @example &lt;caption>Example 1: Search for mods using a JSON query (exact field match)&lt;/caption>
	 * // URL: /api/mods?search=%7B%22modData.modID%22%3A%22example-mod%22%7D
	 * // Decoded query: {"modData.modID":"example-mod"}
	 * 
	 * async function searchExactMatch() {
	 *   try {
	 *     const searchQuery = encodeURIComponent(JSON.stringify({ "modData.modID": "example-mod" }));
	 *     const response = await fetch(`/api/mods?search=${searchQuery}&amp;page=1&amp;size=20`);
	 *     const data = await response.json();
	 *     console.log(data);
	 *     return data;
	 *   } catch (error) {
	 *     console.error("Error fetching data:", error);
	 *   }
	 * }
	 *
	 * @example &lt;caption>Example 2: Search for mods using regex pattern&lt;/caption>
	 * // Using case-insensitive regex to find mods containing specific text
	 * async function searchWithRegex() {
	 *   try {
	 *     const searchQuery = encodeURIComponent(JSON.stringify({
	 *       "modData.modID": { $regex: "mod id here", $options: 'i'}
	 *     }));
	 *     const url = `https://fluxloader.app/api/mods?search=${searchQuery}&amp;page=1&amp;size=5000`;
	 *     const response = await fetch(url);
	 *     const data = await response.json();
	 *     console.log(data);
	 *     return data;
	 *   } catch (error) {
	 *     console.error("Error searching with regex:", error);
	 *   }
	 * }
	 *
	 * @example &lt;caption>Example 3: Complex query with multiple conditions&lt;/caption>
	 * // Search for mods by a specific author that contain a certain tag
	 * async function searchWithComplexQuery() {
	 *   try {
	 *     const query = {
	 *       $and: [
	 *         { "modData.author": "AuthorName" },
	 *         { "modData.tags": { $in: ["gameplay"] } }
	 *       ]
	 *     };
	 *     const searchQuery = encodeURIComponent(JSON.stringify(query));
	 *     const response = await fetch(`/api/mods?search=${searchQuery}&amp;page=1&amp;size=20`);
	 *     const data = await response.json();
	 *     console.log(data);
	 *     return data;
	 *   } catch (error) {
	 *     console.error("Error with complex query:", error);
	 *   }
	 * }
	 * @example &lt;caption>Example 4: Error handling for search queries&lt;/caption>
	 * // Always add error handling for search API calls
	 * async function searchWithErrorHandling() {
	 *   try {
	 *     const searchQuery = encodeURIComponent(JSON.stringify({
	 *       "modData.name": { $regex: "test", $options: "i" }
	 *     }));
	 *     const response = await fetch(`/api/mods?search=${searchQuery}`);
	 *     const data = await response.json();
	 *
	 *     if (data.error) {
	 *       console.error("Search error:", data.error);
	 *       // Handle the error appropriately
	 *     } else {
	 *       console.log("Search results:", data.mods);
	 *       return data.mods;
	 *     }
	 *   } catch (err) {
	 *     console.error("Network error:", err);
	 *   }
	 * }
	 *
	 * @example &lt;caption>Example 5: Fetch mod metadata (latest version)&lt;/caption>
	 * // URL: /api/mods?modid=1234&amp;option=info
	 * async function fetchModMetadata(modId) {
	 *   try {
	 *     const response = await fetch(`/api/mods?modid=${modId}&amp;option=info`);
	 *     const data = await response.json();
	 *     console.log(data);
	 *     return data;
	 *   } catch (error) {
	 *     console.error("Error fetching metadata:", error);
	 *   }
	 * }
	 *
	 * @example &lt;caption>Example 6: Fetch mod metadata (specific version)&lt;/caption>
	 * // URL: /api/mods?modid=1234&amp;option=info&amp;version=1.0.0
	 * async function fetchSpecificModVersion(modId, version) {
	 *   try {
	 *     const response = await fetch(`/api/mods?modid=${modId}&amp;option=info&amp;version=${version}`);
	 *     const data = await response.json();
	 *     console.log(data);
	 *     return data;
	 *   } catch (error) {
	 *     console.error("Error fetching specific version:", error);
	 *   }
	 * }
	 *
	 * @example &lt;caption>Example 7: Download a mod version&lt;/caption>
	 * // URL: /api/mods?modid=1234&amp;option=download&amp;version=1.0.0
	 * async function downloadModVersion(modId, version) {
	 *   try {
	 *     const response = await fetch(`/api/mods?modid=${modId}&amp;option=download&amp;version=${version}`);
	 *     const blob = await response.blob();
	 *
	 *     const url = window.URL.createObjectURL(blob);
	 *     const a = document.createElement('a');
	 *     a.style.display = 'none';
	 *     a.href = url;
	 *     a.download = `mod-${version}.zip`;
	 *     document.body.appendChild(a);
	 *     a.click();
	 *     window.URL.revokeObjectURL(url);
	 *     document.body.removeChild(a);
	 *   } catch (error) {
	 *     console.error("Error downloading mod:", error);
	 *   }
	 * }
	 *
	 * @example &lt;caption>Example 8: Fetch all available versions of a mod&lt;/caption>
	 * // URL: /api/mods?modid=1234&amp;option=versions
	 * async function fetchAllModVersions(modId) {
	 *   try {
	 *     const response = await fetch(`/api/mods?modid=${modId}&amp;option=versions`);
	 *     const data = await response.json();
	 *     console.log(data);
	 *     return data;
	 *   } catch (error) {
	 *     console.error("Error fetching versions:", error);
	 *   }
	 * }
	 * 
	 * @example &lt;caption>Example 9: Fetch full version data for all versions of a mod&lt;/caption>
	 * // URL: /api/mods?modid=1234&amp;option=versions&amp;data=true
	 * async function fetchAllModVersionsData(modId) {
	 *   try {
	 *     const response = await fetch(`/api/mods?modid=${modId}&amp;option=versions&amp;data=true`);
	 *     const data = await response.json();
	 *     console.log("Full version data:", data.versions);
	 *     return data.versions;
	 *   } catch (error) {
	 *     console.error("Error fetching version data:", error);
	 *   }
	 * }
	 * 
	 * @example &lt;caption>Example 10: Fetch version numbers for multiple mods at once&lt;/caption>
	 * // URL: /api/mods?modids=1234,5678,9012&amp;option=versions
	 * async function fetchMultipleModVersions(modIds) {
	 *   try {
	 *     // Join the array of mod IDs with commas
	 *     const modIdsParam = modIds.join(',');
	 *     const response = await fetch(`/api/mods?modids=${modIdsParam}&amp;option=versions`);
	 *     const data = await response.json();
	 *     
	 *     // data.versions is an object where keys are mod IDs and values are arrays of version numbers
	 *     console.log("Versions for multiple mods:", data.versions);
	 *     
	 *     // Example of accessing versions for a specific mod
	 *     if (data.versions[modIds[0]]) {
	 *       console.log(`Versions for ${modIds[0]}:`, data.versions[modIds[0]]);
	 *     }
	 *     
	 *     return data.versions;
	 *   } catch (error) {
	 *     console.error("Error fetching multiple mod versions:", error);
	 *   }
	 * }
	 * 
	 * @example &lt;caption>Example 11: Batch search for multiple specific mod IDs&lt;/caption>
	 * // Search for several mods by their IDs in a single query
	 * async function batchSearchByModIds(modIds) {
	 *   try {
	 *     // Create a MongoDB query using $in operator to match any of the provided IDs
	 *     const query = {
	 *       "modID": { 
	 *         "$in": modIds  // Array of mod IDs to search for
	 *       }
	 *     };
	 *     
	 *     const searchQuery = encodeURIComponent(JSON.stringify(query));
	 *     const response = await fetch(`/api/mods?search=${searchQuery}&amp;size=100`);
	 *     const data = await response.json();
	 *     
	 *     if (data.error) {
	 *       console.error("Batch search error:", data.error);
	 *       return null;
	 *     }
	 *     
	 *     // Create a map of found mods indexed by modID for easy lookup
	 *     const modsMap = {};
	 *     data.mods.forEach(mod => {
	 *       modsMap[mod.modID] = mod;
	 *     });
	 *     
	 *     // Check which mod IDs were not found
	 *     const notFoundIds = modIds.filter(id => !modsMap[id]);
	 *     if (notFoundIds.length > 0) {
	 *       console.warn("Some mod IDs were not found:", notFoundIds);
	 *     }
	 *     
	 *     console.log(`Found ${data.mods.length} of ${modIds.length} requested mods`);
	 *     return {
	 *       found: data.mods,
	 *       foundMap: modsMap,
	 *       notFound: notFoundIds
	 *     };
	 *   } catch (error) {
	 *     console.error("Error in batch mod search:", error);
	 *     return null;
	 *   }
	 * }
	 * 
	 * // Example usage:
	 * // const result = await batchSearchByModIds(['mod-123', 'mod-456', 'mod-789']);
	 * // Access specific mod: result.foundMap['mod-123']
	 * 
	 * @example &lt;caption>Example 12: Search for mods containing multiple specific tags&lt;/caption>
	 * // Search for mods that have ALL of the specified tags
	 * async function searchModsByMultipleTags(requiredTags) {
	 *   try {
	 *     // The $all operator ensures that the mod has all the specified tags
	 *     // This finds mods where modData.tags array contains all elements in requiredTags
	 *     const query = {
	 *       "modData.tags": { 
	 *         "$all": requiredTags  // Array of required tags - mod must have ALL of these
	 *       }
	 *     };
	 *     
	 *     const searchQuery = encodeURIComponent(JSON.stringify(query));
	 *     const response = await fetch(`/api/mods?search=${searchQuery}`);
	 *     const data = await response.json();
	 *     
	 *     if (data.error) {
	 *       console.error("Tags search error:", data.error);
	 *       return null;
	 *     }
	 *     
	 *     console.log(`Found ${data.mods.length} mods containing all tags: ${requiredTags.join(', ')}`);
	 *     
	 *     return {
	 *       mods: data.mods,
	 *       count: data.mods.length,
	 *       tags: requiredTags
	 *     };
	 *   } catch (error) {
	 *     console.error("Error in multi-tag search:", error);
	 *     return null;
	 *   }
	 * }
	 * 
	 * // Example usage:
	 * // Search for mods with both "gameplay" and "multiplayer" tags
	 * // const gameMods = await searchModsByMultipleTags(['gameplay', 'multiplayer']);
	 */
	run: async function (req, res) {
		try {
			// Extract query parameters from the request URL
			var queryurl = req.url.split("?")[1];
			var query = queryurl.split("&amp;");
			var querys = {};
			query.forEach(function (urlvar) {
				var varsplit = urlvar.split("=");
				querys[varsplit[0]] = varsplit[1];
			});

			// Check that atleast one of the endpoints will be used
			if (querys["search"] == undefined &amp;&amp; ((querys["modid"] == undefined &amp;&amp; querys["modids"] == undefined) || querys["option"] == undefined)) {
				res.writeHead(201, { "Content-Type": "application/json" });
				res.end(
					JSON.stringify({
						error: "Missing required query parameters",
						missing: {
							modid: querys["modid"] === undefined,
							modids: querys["modids"] === undefined,
							option: querys["option"] === undefined,
						},
					})
				);
				return;
			}

			// /api/mods
			if (querys["search"] == undefined) {
				switch (querys["option"]) {
					// /api/mods?option=download
					case "download":
						try {
							var modID = querys["modid"];
							if (!modID) {
								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(
									JSON.stringify({
										error: "ModID is required to download the mod.",
									})
								);
								return;
							}
							log.info(`Attempting to retrieve mod data for modID: ${modID}, version: ${querys["version"] || "latest"}`);
							var modData = {};
							if (querys["version"]) {
								modData = await Mongo.GetMod.Versions.One(modID, querys["version"]);
							} else {
								modData = await Mongo.GetMod.Versions.One(modID);
							}
							log.info(
								`Retrieved modData: ${JSON.stringify({
									modID: modID,
									version: querys["version"] || "latest",
									hasModData: !!modData,
									hasModfile: modData &amp;&amp; !!modData.modfile,
									modDataKeys: modData ? Object.keys(modData) : [],
								})}`
							);
							if (!modData) {
								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(
									JSON.stringify({
										error: "No mod version found for the specified mod ID and version.",
										modID,
										version: querys["version"] || "latest",
									})
								);
								return;
							}
							if (!modData.modfile) {
								log.info(`Mod file data is missing for modID: ${modID}, version: ${querys["version"] || "latest"}`);
								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(
									JSON.stringify({
										error: "Mod file data is missing for the specified mod version.",
										modID,
										version: querys["version"] || "latest",
									})
								);
								return;
							}
							log.info(`Processing download for modID: ${modID}, version: ${querys["version"] || "latest"}, modfile length: ${modData.modfile ? modData.modfile.length : 0}`);
							var compressedBuffer = Buffer.from(modData.modfile, "base64");
							var decompressedBuffer = await decompress(compressedBuffer);
							res.writeHead(200, {
								"Content-Type": "application/zip",
								"Content-Disposition": `attachment; filename=${modData.modData.name}.zip`,
							});
							res.end(decompressedBuffer);
						} catch (error) {
							log.info(`Error processing mod download: ${error.message}`);
							log.info(`Error stack: ${error.stack}`);
							log.info(
								`Error context: modID=${modID}, version=${querys["version"] || "latest"}, modData=${JSON.stringify({
									exists: !!modData,
									hasModfile: modData &amp;&amp; !!modData.modfile,
									modfileLength: modData &amp;&amp; modData.modfile ? modData.modfile.length : 0,
									modDataKeys: modData ? Object.keys(modData) : [],
								})}`
							);

							res.writeHead(201, { "Content-Type": "application/json" });
							res.end(
								JSON.stringify({
									error: "An error occurred while processing the download.",
									details: error.message,
									modID: modID,
									version: querys["version"] || "latest",
								})
							);
						}

						break;

					// /api/mods?option=info
					case "info":
						try {
							var modID = querys["modid"];
							if (!modID) {
								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(
									JSON.stringify({
										error: "ModID is required to fetch the mod information.",
									})
								);
								return;
							}
							log.info(`Attempting to retrieve mod info for modID: ${modID}, version: ${querys["version"] || "latest"}`);
							var modVersion = {};
							if (querys["version"]) {
								modVersion = await Mongo.GetMod.Versions.One(modID, querys["version"], { modfile: 0 });
							} else {
								modVersion = await Mongo.GetMod.Versions.One(modID, "", { modfile: 0 });
							}
							log.info(
								`Retrieved modVersion: ${JSON.stringify({
									modID: modID,
									version: querys["version"] || "latest",
									hasModVersion: !!modVersion,
									modVersionKeys: modVersion ? Object.keys(modVersion) : [],
								})}`
							);

							if (!modVersion) {
								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(
									JSON.stringify({
										message: "No mod version found for the specified mod ID and version.",
										modID,
										version: querys["version"] || "latest",
									})
								);
								return;
							}

							res.writeHead(201, { "Content-Type": "application/json" });
							res.end(JSON.stringify({ mod: modVersion }));
						} catch (err) {
							log.info(`Error fetching mod info: ${err.message}`);
							log.info(`Error stack: ${err.stack}`);
							log.info(
								`Error context: modID=${modID}, version=${querys["version"] || "latest"}, modVersion=${JSON.stringify({
									exists: !!modVersion,
									modVersionKeys: modVersion ? Object.keys(modVersion) : [],
								})}`
							);

							res.writeHead(201, { "Content-Type": "application/json" });
							res.end(
								JSON.stringify({
									error: "An internal server error occurred while fetching mod information.",
									details: err.message,
									modID: modID,
									version: querys["version"] || "latest",
								})
							);
						}

						break;

					// /api/mods?option=versions
					case "versions":
						try {
							var modID = querys["modid"];
							var modIDs = querys["modids"];

							log.info(
								`Attempting to retrieve versions with parameters: ${JSON.stringify({
									modID: modID || null,
									modIDs: modIDs || null,
									data: querys["data"] || false,
								})}`
							);

							// Check if modids parameter is provided (for multiple mod IDs)
							if (modIDs) {
								// Parse the comma-separated list of mod IDs
								var modIDsArray = modIDs.split(",");
								log.info(`Processing versions request for multiple modIDs: ${modIDsArray.join(", ")}`);

								// Check if full version data is requested
								if (querys["data"] === "true") {
									// This feature is not implemented for multiple mod IDs
									res.writeHead(201, { "Content-Type": "application/json" });
									res.end(
										JSON.stringify({
											error: "Full version data is not supported for multiple mod IDs. Use single modid parameter for full data.",
										})
									);
									return;
								}

								// Get version numbers for multiple mod IDs
								var versionsMap = await Mongo.GetMod.Versions.MultipleNumbers(modIDsArray);

								log.info(
									`Retrieved versions for multiple modIDs: ${JSON.stringify({
										requestedCount: modIDsArray.length,
										returnedCount: Object.keys(versionsMap).length,
										missingModIDs: modIDsArray.filter((id) => !versionsMap[id] || versionsMap[id].length === 0),
									})}`
								);

								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(JSON.stringify({ versions: versionsMap }));
							}
							// Handle single mod ID case (original behavior)
							else if (modID) {
								log.info(`Processing versions request for single modID: ${modID}`);
								// Check if full version data is requested
								if (querys["data"] === "true") {
									// Get all version data (excluding the modfile to reduce payload size)
									var versionsData = await Mongo.GetMod.Versions.All(modID, { modfile: 0 });

									log.info(
										`Retrieved full version data for modID ${modID}: ${JSON.stringify({
											count: versionsData.length,
											versions: versionsData.length > 0 ? versionsData.map((v) => v.version) : [],
										})}`
									);

									if (versionsData.length === 0) {
										res.writeHead(201, { "Content-Type": "application/json" });
										res.end(
											JSON.stringify({
												message: "No versions found for the specified mod ID.",
												modID: modID,
											})
										);
										return;
									}

									res.writeHead(201, { "Content-Type": "application/json" });
									res.end(JSON.stringify({ versions: versionsData }));
								}
								
								// Get only version numbers (origina#l behavior)
								else {
									var versions = await Mongo.GetMod.Versions.Numbers(modID);

									log.info(
										`Retrieved version numbers for modID ${modID}: ${JSON.stringify({
											count: versions.length,
											versions: versions,
										})}`
									);

									if (versions.length === 0) {
										res.writeHead(201, { "Content-Type": "application/json" });
										res.end(
											JSON.stringify({
												message: "No versions found for the specified mod ID.",
												modID: modID,
											})
										);
										return;
									}

									res.writeHead(201, { "Content-Type": "application/json" });
									res.end(JSON.stringify({ versions }));
								}
							} else {
								// Neither modid nor modids parameter was provided
								res.writeHead(201, { "Content-Type": "application/json" });
								res.end(
									JSON.stringify({
										error: "Either modid or modids parameter is required to fetch versions.",
									})
								);
								return;
							}
						} catch (err) {
							log.info(`Error fetching versions: ${err.message}`);
							log.info(`Error stack: ${err.stack}`);
							log.info(
								`Error context: ${JSON.stringify({
									modID: modID || null,
									modIDs: modIDs || null,
									modIDsArray: modIDs ? modIDsArray : null,
									dataRequested: querys["data"] === "true",
								})}`
							);

							res.writeHead(201, { "Content-Type": "application/json" });
							res.end(
								JSON.stringify({
									error: "An internal server error occurred while fetching versions.",
									details: err.message,
									modID: modID || null,
									modIDs: modIDs ? modIDsArray : null,
								})
							);
						}
						break;
					default:
				}
			}

			// /api/mods?search
			else {
				try {
					// Parse search query from the URL-encoded JSON string
					var searchQuery = decodeURIComponent(querys["search"]);
					var parsedQuery;
					try {
						parsedQuery = JSON.parse(searchQuery);
						if (!parsedQuery || typeof parsedQuery !== "object") {
							throw new Error("Invalid search query format");
						}
					} catch (jsonError) {
						log.info("Invalid JSON search query: " + jsonError.message);
						res.writeHead(201, { "Content-Type": "application/json" });
						res.end(
							JSON.stringify({
								error: "Invalid search query format. Please provide a valid JSON query.",
								details: jsonError.message,
							})
						);
						return;
					}

					var mods = [];
					var VerifiedOnly = true;
					if (querys["verified"]) {
						if (querys["verified"] == "true") {
						} else if (querys["verified"] == "false") {
							VerifiedOnly = false;
						} else {
							VerifiedOnly = null;
						}
					}
					if (!searchQuery || searchQuery.trim() === "") {
						searchQuery = "[]";
					}

					if (querys["page"]) {
						var page = { number: parseInt(querys["page"]), size: 200 };
						if (querys["size"]) {
							page.size = parseInt(querys["size"]);
						}
						mods = await Mongo.GetMod.Data.Search(searchQuery, VerifiedOnly, false, page);
					} else {
						mods = await Mongo.GetMod.Data.Search(searchQuery, VerifiedOnly, false);
					}

					if (mods.length === 0) {
						res.writeHead(201, { "Content-Type": "application/json" });
						res.end(
							JSON.stringify({
								message: "No mods found matching your search query.",
								searchQuery,
							})
						);
						return;
					}

					res.writeHead(201, { "Content-Type": "application/json" });
					res.end(
						JSON.stringify({
							message: "Search results successfully fetched",
							resultsCount: mods.length,
							mods,
						})
					);
				} catch (error) {
					log.info("Error occurred while searching mods:" + error);

					res.writeHead(201, { "Content-Type": "application/json" });
					res.end(
						JSON.stringify({
							error: "An error occurred while processing your search.",
							details: error.message,
						})
					);
				}
			}
		} catch (error) {
			res.writeHead(200, { "Content-Type": "application/json" });
			res.end(JSON.stringify({ error: "Missing required query parameters" }));
		}
	},
};
</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-modules"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-DB.html">DB</a></div><div class="sidebar-section-children"><a href="module-api.html">api</a></div><div class="sidebar-section-children"><a href="module-discord.html">discord</a></div><div class="sidebar-section-children"><a href="module-main.html">main</a></div><div class="sidebar-section-children"><a href="module-timers.html">timers</a></div><div class="sidebar-section-children"><a href="module-web.html">web</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Log.html">Log</a></div><div class="sidebar-section-children"><a href="UserEntry.html">UserEntry</a></div><div class="sidebar-section-children"><a href="module-DB.ActionEntry.html">ActionEntry</a></div><div class="sidebar-section-children"><a href="module-DB.ModEntry.html">ModEntry</a></div><div class="sidebar-section-children"><a href="module-DB.ModVersionEntry.html">ModVersionEntry</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Config.html">Config</a></div><div class="sidebar-section-children"><a href="module-DB.GetAction.html">GetAction</a></div><div class="sidebar-section-children"><a href="module-DB.GetMod.html">GetMod</a></div><div class="sidebar-section-children"><a href="module-DB.GetMod.Data.html">Data</a></div><div class="sidebar-section-children"><a href="module-DB.GetMod.Versions.html">Versions</a></div><div class="sidebar-section-children"><a href="module-DB.GetUser.html">GetUser</a></div><div class="sidebar-section-children"><a href="module-api.actions.html">actions</a></div><div class="sidebar-section-children"><a href="module-api.admin.html">admin</a></div><div class="sidebar-section-children"><a href="module-api.adminactions.html">adminactions</a></div><div class="sidebar-section-children"><a href="module-api.config.html">config</a></div><div class="sidebar-section-children"><a href="module-api.search.html">search</a></div><div class="sidebar-section-children"><a href="module-api.uploadmod.html">uploadmod</a></div><div class="sidebar-section-children"><a href="module-api.users.html">users</a></div><div class="sidebar-section-children"><a href="module-discord.BotEvents.html">BotEvents</a></div><div class="sidebar-section-children"><a href="module-discord.Events.html">Events</a></div><div class="sidebar-section-children"><a href="module-discord.Events.clientready.html">clientready</a></div><div class="sidebar-section-children"><a href="module-discord.Events.interactioncreate.html">interactioncreate</a></div><div class="sidebar-section-children"><a href="module-discord.commands.html">commands</a></div><div class="sidebar-section-children"><a href="module-discord.commands.GetModInfo.html">GetModInfo</a></div><div class="sidebar-section-children"><a href="module-discord.commands.GetModVersions.html">GetModVersions</a></div><div class="sidebar-section-children"><a href="module-discord.commands.getSiteActions.html">getSiteActions</a></div><div class="sidebar-section-children"><a href="module-discord.commands.searchMods.html">searchMods</a></div><div class="sidebar-section-children"><a href="module-timers.logactions.html">logactions</a></div><div class="sidebar-section-children"><a href="module-timers.updatemods.html">updatemods</a></div><div class="sidebar-section-children"><a href="module-timers.validatemod.html">validatemod</a></div><div class="sidebar-section-children"><a href="module-web.admin.html">admin</a></div><div class="sidebar-section-children"><a href="module-web.discordAuth.html">discordAuth</a></div><div class="sidebar-section-children"><a href="module-web.generateMod.html">generateMod</a></div><div class="sidebar-section-children"><a href="module-web.home.html">home</a></div><div class="sidebar-section-children"><a href="module-web.upload.html">upload</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-global"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#handleClient">handleClient</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>