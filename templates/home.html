<div class="pagecontainer">
    <div class="headerContainer" id="headerContainer">
        <div class="btn btn-secondary headerButton" style="margin-left: 15px;">Mod List</div>
        <div class="input-group mb-3" style="width: 50%; padding-top: 15px;">
            <button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <div class="dropdown-menu">
                <h3 class="dropdown-item">Search Help</h3>
                <p class="dropdown-item">Click to add to search</p>
                <p class="dropdown-item">Tag: <input class="form-control form-control-sm" type="text" placeholder="Tag name"></p>
                <p class="dropdown-item">Author: <input class="form-control form-control-sm" type="text" placeholder="Authors name"></p>
            </div>
            <input type="text" class="form-control">
        </div>
        <a href="/auth/discord" class="btn btn-primary" style="margin-right: 15px;" id="discordLogin">
            <img src="https://cdn.prod.website-files.com/6257adef93867e50d84d30e2/66e3d718355f9c89eb0fd350_Logo.svg"
                 alt="Discord Logo"
                 style="width: 100px; height: 20px; margin-right: 5px;">
        </a>
    </div>
    <div class="modDisplayHolder">
        <div class="modList">

        </div>
        <div class="modDisplay">

        </div>
    </div>
    <script>
        var discordUser = JSON.parse(localStorage.getItem('discordUser'));
        if (discordUser) {
            console.log('Discord User:', discordUser);
            var headerContainer = document.getElementById('headerContainer');
            headerContainer.removeChild(document.getElementById('discordLogin'));

            var discordDropdown = document.createElement('div');
            discordDropdown.className = 'dropdown';

            discordDropdown.innerHTML = `
                <button class="btn dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png" alt="${discordUser.global_name}" class="rounded-circle" style="width: 30px; height: 30px; margin-right: 5px;">
                    ${discordUser.global_name}
                </button>
                <ul class="dropdown-menu" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="/upload">Upload Mod</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" id="logoutButton">Logout</a></li>
                </ul>
            `;

            headerContainer.appendChild(discordDropdown);

            var logoutButton = document.getElementById('logoutButton');
            logoutButton.addEventListener('click', function () {
                localStorage.removeItem('discordUser');
                window.location.reload();
            });
        }
        document.addEventListener('DOMContentLoaded', async () => {
            var modListContainer = document.querySelector('.modList');

            try {
                var response = await fetch("/mods");
                if (!response.ok) {
                    throw new Error("Failed to fetch mods.");
                }

                var mods = await response.json();

                if (mods.length === 0) {
                    modListContainer.innerHTML = '<div class="alert alert-info">No mods available.</div>';
                    return;
                }

                var headerRow = document.createElement('div');
                headerRow.className = 'd-flex justify-content-between align-items-center mb-3';

                headerRow.innerHTML = `
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary btn-sm" id="sortByName">Sort by Name</button>
                    <button type="button" class="btn btn-outline-primary btn-sm" id="sortByVersion">Sort by Version</button>
                    <button type="button" class="btn btn-outline-primary btn-sm" id="sortByAuthor">Sort by Author</button>
                </div>
                <span class="text-muted">Showing ${mods.length} mods</span>
            `;

                modListContainer.appendChild(headerRow);

                var listGroup = document.createElement('ul');
                listGroup.className = 'list-group';

                mods.forEach(modData => {
                    var mod = modData.modinfo;

                    var listItem = document.createElement('li');
                    listItem.className = 'list-group-item d-flex justify-content-between align-items-center';

                    listItem.innerHTML = `
                    <div class="mod-info">
                        <strong>${mod.name}</strong>
                        <span class="badge bg-secondary ms-2">v${mod.version}</span>
                    </div>
                    <div class="mod-author">
                        ${mod.author}
                    </div>
                    <div class="mod-tags text-muted">
                        ${mod.tags.join(", ")}
                    </div>
                `;

                    listGroup.appendChild(listItem);
                });

                modListContainer.appendChild(listGroup);

                function sortList(criteria) {
                    mods.sort((a, b) => {
                        var modA = a.modinfo[criteria].toString().toLowerCase();
                        var modB = b.modinfo[criteria].toString().toLowerCase();
                        return modA.localeCompare(modB);
                    });

                    listGroup.innerHTML = '';

                    mods.forEach(modData => {
                        var mod = modData.modinfo;

                        var listItem = document.createElement('li');
                        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';

                        listItem.innerHTML = `
                        <div class="mod-info">
                            <strong>${mod.name}</strong>
                            <span class="badge bg-secondary ms-2">v${mod.version}</span>
                        </div>
                        <div class="mod-author">
                            ${mod.author}
                        </div>
                        <div class="mod-tags text-muted">
                            ${mod.tags.join(", ")}
                        </div>
                    `;

                        listGroup.appendChild(listItem);
                    });
                }

                document.getElementById('sortByName').addEventListener('click', () => sortList('name'));
                document.getElementById('sortByVersion').addEventListener('click', () => sortList('version'));
                document.getElementById('sortByAuthor').addEventListener('click', () => sortList('author'));
            } catch (error) {
                modListContainer.innerHTML = '<div class="alert alert-danger">Unable to load mods.</div>';
            }
        });




    </script>
</div>